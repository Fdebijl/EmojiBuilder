!function(){"use strict";var e;const t=Object.freeze({CSP:"https://floris.amsterdam/reports/csp",CSP_ISSUE:"https://github.com/Fdebijl/EmojiBuilder/issues/new?title=CSP%20Violation&body=",WORKERPATH:"/emojiworker.js",SVG_DIR_PATH:"svg/"}),n=Object.freeze({SCALE:"scale",FLIP:"flip",TRANSLATE:"translate",ROTATE:"rotate"}),o=Object.freeze({HORIZONTAL:"horizontal",VERTICAL:"vertical"});function r(t){$(".grid_"+t).hasClass("loaded")||(!async function(e){new Promise((t,n)=>{e.files.forEach(async e=>new Promise((t,n)=>{$(e.grid).append($.parseHTML(e.html)),t()})),$(".svg-icon").click(function(e){a(this)});let o=document.getElementsByClassName("svg-icon");Array.from(o).forEach(function(e){e.addEventListener("dragstart",function(e){var t;(t=e).dataTransfer.setData("text/html",t.target.id)})}),t()})}(e.grids[t]),$(".grid_"+t).addClass("loaded")),$(".grid").fadeOut(333,function(){$(".grid_"+t).show(),$(".tab").removeClass("tab_active"),$(".tab_"+t).addClass("tab_active")})}function a(e){$(".wrapper").append($.parseHTML('<div class="stagingarea" style="display: none;"></div>')),$(".hinter").remove(),$(".stagingarea").load(e.src,function(){$("#drawboard").append($(".stagingarea").html()),$("defs").remove(),$("metadata").remove(),$(".stagingarea").remove(),l()})}function i(e,t=10){t>0?(UIkit.modal(document.getElementById(e)).show(),setTimeout(function(){UIkit.modal(document.getElementById(e)).hide()},1e3*t)):UIkit.modal(document.getElementById(e)).show()}function l(){$("path").each(function(){new function(e){let t=e,n=t.ownerSVGElement.createSVGPoint(),o=t.ownerSVGElement.createSVGPoint(),r=t.ownerSVGElement.createSVGPoint();function a(e,n){let o=t.ownerSVGElement.createSVGPoint(),r=t.parentNode.getScreenCTM();return o.x=e,o.y=n,o.matrixTransform(r.inverse())}$(t).on("pointerdown",function(e){e.preventDefault(),o=a(e.clientX,e.clientY),$(t).addClass("dragged"),$(t.ownerSVGElement).on("pointermove",t,function(e){let i=a(e.clientX,e.clientY);r.x=n.x+(i.x-o.x),r.y=n.y+(i.y-o.y),s(t,"translate",r.x+","+r.y)}),$(t.ownerSVGElement).on("pointerup",t,function(e){n.x=r.x,n.y=r.y,$(t).removeClass("dragged"),$(t.ownerSVGElement).off("pointermove"),$(t.ownerSVGElement).off("pointerup")})})}(this),$(this).on("click touch",function(e){$("path").removeClass("selected"),$(e.target).addClass("selected")})})}function s(e,t,r){if(!e||!t||!r)throw new Error(`Attempted to apply transformation to path with missing arguments:${e?"":" path"}${t?"":" name"} ${r?"":" value"}`);let a=!1;t===n.FLIP&&(a=!0,t=n.SCALE);let i=$(e).attr("transform"),l=(i=i?i.split(/( )(?=[a-z])/gi).filter(e=>" "!==e):[]).findIndex(e=>e.split("(")[0]===t);if(t!==n.SCALE||2===r.split(" ").length||a||(r=r+" "+r),t===n.SCALE&&l>=0||a){let e;try{e=i[l].match(/\((.+?)\)/g)[0].replace(/\(|\)/g,"")}catch(t){e="1 1"}let t,n,s=e.split(" ")[0],c=e.split(" ")[1];if(a)if(t=s=s,n=c=c,r===o.HORIZONTAL)t*=-1;else{if(r!==o.VERTICAL)throw new Error(`Attempted to apply flip with invalid value '${r}'`);n*=-1}else t=r.split(" ")[0],n=r.split(" ")[1],t=s<0?-1*t:t,n=c<0?-1*n:n;r=t+" "+n}return l>=0?i[l]=i[l].replace(/\((.+?)\)/g,`(${r})`):i.push(`${t}(${r})`),i.sort().reverse(),$(e).attr("transform",i.join(" ")),i.join(" ")}$(window).on("securitypolicyviolation",function(e){let n=e.original,o={time:Date.now(),uri:n.blockedURI,docuri:n.documentURI,disposition:n.disposition,effectivedirective:n.effectiveDirective,violateddirective:n.violatedDirective,line:n.lineNumber,referrer:n.referrer,sample:n.sample};$.ajax({url:t.CSP,method:"POST",data:o}).done(function(e){let n=`${t.CSP_ISSUE}${encodeURI(JSON.stringify(o,null,4))}`;$("#csp-issue-link").attr("href",n),i("fatal-modal",30)})}),$(window).on("load",function(){document.getElementById("drawboard").addEventListener("drop",function(e){var t;e.preventDefault(),e.stopPropagation(),t=e,a(document.getElementById(t.dataTransfer.getData("text/html")))}),document.getElementById("drawboard").addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation(),e.preventDefault()}),async function(){let e=t.SVG_DIR_PATH;return new Promise((t,n)=>{$.ajax({url:"svgs.json"}).done(function(n){let o={tabs:[],grids:{}};for(let t=0;t<n.length;t++){let a=n[t].name.replace(" ","-"),i=(r=n[t].name).charAt(0).toUpperCase()+r.slice(1).toLowerCase();o.grids[a]={html:'<div class="grid grid_'+a+'"></div>',files:[]},o.tabs.push('<div class="tab tab_'+a+'" data-cat="'+a+'">'+i+"</div>");for(let r=0;r<n[t].dir.length;r++){let i='<img draggable="true" class="svg-icon" id="'+n[t].dir[r].file.split(".")[0]+'" src="'+e+n[t].name+"/"+n[t].dir[r].file+'">',l=".grid_"+a;o.grids[a].files.push({grid:l,html:i})}}var r;t(o)})})}().then(t=>{e=t,async function(e){new Promise((t,n)=>{e.forEach(async e=>new Promise((t,n)=>{$(".tabs").append(e),t()})),$(".tabs > div").click(function(e){r($(this).data("cat"))}),t()})}(t.tabs),async function(e){new Promise((t,n)=>{Object.entries(e).forEach(async e=>new Promise((t,n)=>{$(".emojigrid").append(e[1].html),t()})),t()})}(t.grids)}).then(()=>{window.innerWidth<=500?$(window).one("scroll touchmove",function(e){r("smileys")}):r("smileys")}),setTimeout(function(){$(".hinting").removeClass("hinting")},15e3),$(".ui-loader").remove(),$(".apply-scale").on("click touch",function(e){s($(".selected"),n.SCALE,$("#scale-input").val())}),$(".clear").on("click touch",function(e){$("#drawboard").empty()}),$(".open").on("click touch",function(e){!function(){let e=$(document.createElement("input"));e.attr("type","file"),e.on("change",function(e){let t=this.files[0],n=new FileReader;n.onload=function(e){var t;t=e.target.result,$(".wrapper").append($.parseHTML('<div class="stagingarea" style="display: none;"></div>')),$(".hinter").remove(),$(".stagingarea").html(t),$("#drawboard").append($(".stagingarea").html()),$("defs").remove(),$("metadata").remove(),$(".stagingarea").remove(),l()},n.readAsText(t)}),e.click()}()}),$(".saveas").on("click touch",function(e){i("save-modal",0)}),$(".delete").on("click touch",function(e){$(".selected").remove()}),$(".forward").on("click touch",function(e){$(".selected").parent().insertAfter($(".selected").parent().next())}),$(".backward").on("click touch",function(e){$(".selected").parent().insertBefore($(".selected").parent().prev())}),$(".fliphorizontal").on("click touch",function(e){s($(".selected"),n.FLIP,o.HORIZONTAL)}),$(".flipvertical").on("click touch",function(e){s($(".selected"),n.FLIP,o.VERTICAL)}),$(".rotate90cw").on("click touch",function(e){s($(".selected"),n.ROTATE,90)}),$(".rotate90ccw").on("click touch",function(e){s($(".selected"),n.ROTATE,-90)}),$(".rotate").on("click touch",function(e){}),$(".scale").on("click touch",function(e){i("scale-modal",0)}),$(".help").on("click touch",function(e){i("info-modal",0)}),$(".download-png").on("click touch",function(e){!function(){UIkit.modal(document.getElementById("loading-modal")).show(),$(".wrapper").append($.parseHTML('<canvas id="renderbox"></canvas>')),$("#renderbox, #drawboard > svg").width($("#drawboard").outerWidth()),$("#renderbox, #drawboard > svg").height($("#drawboard").outerHeight());let e="";if(1===$("#drawboard > svg").length)e=$.trim($("#drawboard").html().replace(/<!--[\s\S]*?-->/gi,""));else{let t='<div class="mergehelper" style="display: none;"></div>';$(".wrapper").append($.parseHTML(t)),$(".mergehelper").html($("#drawboard").html()),$(".mergehelper").html($(".mergehelper").html().replace(/<!--[\s\S]*?-->/gi,""));let n=$(".mergehelper > svg");for(let e=1;e<n.length;e++){let t=$(n[e]).html();$(".mergehelper > svg").eq(0).append(t),$(n[e]).remove()}e=$.trim($(".mergehelper").html())}canvg("renderbox",e,{log:!0,ignoreMouse:!0,ignoreDimensions:!1,renderCallback:function(){setTimeout(function(){let e=document.getElementById("renderbox"),t=e.toDataURL("image/png"),n=document.createElement("a");n.href=t,n.download="emoji.png",n.click(),$(n).remove(),UIkit.modal(document.getElementById("loading-modal")).hide(),$("#renderbox, .mergehelper").remove()},333*$("#drawboard > svg").length)}})}()}),$(".download-svg").on("click touch",function(e){!function(){let e="data:image/svg+xml;charset=utf-8,"+encodeURIComponent($("#drawboard").html()),t=document.createElement("a");t.href=e,t.download="emoji.svg",t.click(),$(t).remove()}()}),"serviceWorker"in navigator&&navigator.serviceWorker.register(t.WORKERPATH),navigator.storage&&navigator.storage.persist&&($(".persist").removeClass("disabled"),navigator.storage.estimate().then(e=>{$(".cachesize").html(`${Math.round(e.usage/1e3/1e3*100)/100}MB`)}),$(".persist").on("click touch",function(e){i("persist-modal",0)}),$(".persist-granted").on("click touch",function(e){navigator.storage.persist().then(e=>{console.info("Persistent storage permissisons granted.")})}))}),window.ApplyTransform=s,$("html").keyup(function(e){switch(e.keyCode){case 46:$(".selected").remove();break;case 68:$(".selected").removeClass("selected")}})}();